<!DOCTYPE html>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Add Book – ShelfSpace</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Flash popup */
        .flash-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 12px 18px;
            border-radius: 8px;
            z-index: 9999;
            animation: fadeInOut 3s ease forwards;
            font-size: 1rem;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: translateY(-10px);
            }

            10% {
                opacity: 1;
                transform: translateY(0);
            }

            90% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                transform: translateY(-10px);
            }
        }

        /* Buttons above cover */
        .button-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .upload-btn, .delete-cover-btn {
            font-size: 1rem;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
        }

        .upload-btn {
            background: #007bff;
            color: white;
            border: none;
        }

            .upload-btn:hover {
                background: #0056b3;
            }

        .delete-cover-btn {
            background: #a30000;
            color: white;
            border: none;
        }

            .delete-cover-btn:hover {
                background: #cc0000;
            }

        /* Cover preview */
        .cover-preview {
            width: 220px;
            height: 300px;
            object-fit: contain;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin-top: 10px;
            background: white;
        }

        /* Form inputs/textarea */
        .edit-form input,
        .edit-form textarea {
            width: 100%;
            padding: 8px 10px;
            font-size: 0.9rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: inherit;
            background-color: #f5f5f5; /* same grey as other fields */
        }

        .edit-form textarea {
            resize: vertical;
        }

        .edit-form label {
            font-size: 1.1rem;
            font-weight: 500;
            display: block;
            margin-bottom: 4px;
        }

        .edit-btn {
            margin-top: 10px;
            padding: 10px 18px;
            font-size: 1rem;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

            .edit-btn:hover {
                background: #218838;
            }
    </style>
</head>
<body>
    <div class="page-container">

        <!-- NAVBAR -->
        <div class="navbar">
            <div class="nav-left">
                <a href="{{ url_for('home') }}">Home</a>
                <a href="{{ url_for('books') }}">Books</a>
                <a href="#">About</a>
                <a href="#">Contact</a>
            </div>
            <div class="nav-center">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="ShelfSpace logo">
            </div>
            <div class="nav-right">
                <a href="{{ url_for('accountdetails') }}">Account</a>
                <a href="{{ url_for('logout') }}">Log Out</a>
            </div>
        </div>

        <!-- Back button -->
        <a href="{{ url_for('books') }}" class="back-top-left">← Back to Book List</a>

        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="flash-popup {{ category }}">{{ message }}</div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <main class="edit-page">
            <div class="edit-wrapper">

                <!-- LEFT COLUMN: Cover Preview + Buttons -->
                <div class="edit-image" style="display: flex; flex-direction: column; align-items: center;">
                    <div class="button-row">
                        <label for="cover" class="upload-btn">Upload Cover</label>
                        <input type="file" id="cover" name="cover" accept="image/*" hidden>
                        <button id="deleteCover" class="delete-cover-btn" type="button">Remove</button>
                    </div>
                    <img id="coverPreview" src="{{ url_for('static', filename='book_covers/default.png') }}" class="cover-preview" alt="Book Cover Preview">
                </div>

                <!-- RIGHT COLUMN: Form -->
                <div class="edit-box">
                    <h2>Add New Book</h2>
                    <form method="POST" enctype="multipart/form-data" class="edit-form" id="addBookForm">

                        <label for="isbn">ISBN (13 digits)</label>
                        <input type="text" id="isbn" name="isbn" maxlength="13" pattern="\d{13}" required>

                        <label for="title">Title</label>
                        <input type="text" id="title" name="title" required>

                        <label for="author">Author</label>
                        <input type="text" id="author" name="author" required>

                        <label for="genre">Genre</label>
                        <input type="text" id="genre" name="genre" required>

                        <label for="description">Description</label>
                        <textarea id="description" name="description" rows="4" required></textarea>

                        <label for="price">Price ($)</label>
                        <input type="number" id="price" name="price" step="0.01" min="0" required>

                        <label for="stock">Stock Quantity</label>
                        <input type="number" id="stock" name="stock" min="0" required>

                        <button type="submit" class="edit-btn">Add Book</button>
                    </form>
                </div>

            </div>
        </main>
    </div>

    <!-- JS -->
    <script>
    // Cover preview
    const uploadInput = document.getElementById("cover");
    const coverPreview = document.getElementById("coverPreview");
    uploadInput.addEventListener("change", function () {
        if (this.files[0]) {
            coverPreview.src = URL.createObjectURL(this.files[0]);
        }
    });

    document.getElementById("deleteCover").addEventListener("click", function () {
        uploadInput.value = "";
        coverPreview.src = "{{ url_for('static', filename='book_covers/default.png') }}";
    });

    // Form validation for all fields including cover
    document.getElementById("addBookForm").addEventListener("submit", function(e) {
        if (!uploadInput.value.trim()) {
            alert("Please upload a cover image.");
            e.preventDefault();
        }
    });
    </script>
</body>
</html>

