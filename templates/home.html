<!DOCTYPE html>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
<html>
<head>
    <title>ShelfSpace</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo3.png') }}">
    <style>
        /* Quick inline styles for stars */
        .stars {
            color: gold;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .filter-container {
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="nav-left">
            <a class="navbar_active" href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('books') }}">Books</a>
            <a href="{{ url_for('about') }}">About</a>
            <a href="{{ url_for('contact') }}">Contact</a>
        </div>

        <div class="nav-center">
            <img src="{{ url_for('static', filename='images/logo.png') }}" />
        </div>

        <div class="nav-right">
            {% if not current_user.is_authenticated %}
            <a href="{{ url_for('register') }}">Register</a>
            <a href="{{ url_for('login') }}">Log In</a>
            {% else %}
            <p>Hello, {{ current_user.username }}!</p>
            {% if current_user.role == 'customer' %}
            <a href="{{ url_for('view_cart') }}" class="cart-link">
                <img src="{{ url_for('static', filename='images/cart-icon.png') }}" alt="Cart" class="cart-icon">
                {% if cart_count and cart_count > 0 %}
                <span class="cart-badge">{{ cart_count }}</span>
                {% endif %}
            </a>
            <a href="{{ url_for('view_wishlist') }}" class="wishlist-link">
                <img src="{{ url_for('static', filename='images/heart-icon.png') }}" alt="Wishlist" class="wishlist-icon">
            </a>
            {% endif %}
            <a href="{{ url_for('accountdetails') }}">Account</a>
            <a href="{{ url_for('logout') }}">Log Out</a>
            {% endif %}
        </div>
    </div>

    <div class="flash-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
    </div>

    <div class="home-search-container">
        <h2 class="home-search-title">Find your next book</h2>
        <form method="get" action="{{ url_for('books') }}">
            <input class="home-search-box" type="text" name="search" placeholder="Search by title or author" value="{{ search_query }}">
            <button class="home-search-button" type="submit">Search</button>
        </form>
    </div>

    <!-- BOOK GRID -->
    <div class="homepage-book-grid-container">
        <h2>Fantasy</h2>
        <ul class="homepage-book-grid">
            {% for book in books if book.Genre == 'Fantasy' %}
            <li class="book-card" data-genre="{{ book.Genre }}" data-author="{{ book.Author }}" data-price="{{ book.Price }}">
                <a href="{{ url_for('book_detail', isbn=book.ISBN) }}">
                    <img class="book-cover"
                         src="{{ url_for('static', filename='book_covers/' ~ book.ISBN ~ '.jpg') }}"
                         onerror="this.onerror=null; this.src='{{ url_for('static', filename='book_covers/default.jpg') }}';"
                         alt="Cover for {{ book.Title }}">
                    <h3>{{ book.Title }}</h3>
                    <p>by {{ book.Author }}</p>
                    <p>${{ book.Price }}</p>

                    {% if book.avg_rating %}
                    <div class="stars">
                        {% for i in range(1, 6) %}
                        {% if i <= book.avg_rating|round(0, 'floor') %}
                        ★
                        {% else %}
                        ☆
                        {% endif %}
                        {% endfor %}
                        ({{ book.avg_rating }})
                    </div>
                    {% else %}
                    <div class="stars">
                        No reviews yet
                    </div>
                    {% endif %}
                </a>

                <!-- Employee Actions -->
                {% if current_user.role != 'customer' %}
                <div class="book-actions">
                    <!-- Edit stays a link because it’s GET -->
                    <a href="{{ url_for('edit_book', isbn=book.ISBN) }}">Edit</a>
                    <br>
                    <!-- Delete uses POST form -->
                    <form method="post" action="{{ url_for('delete_book', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Delete</button>
                    </form>
                </div>

                <!-- Customer Actions -->
                {% else %}
                <!-- Customer Actions -->
                <div class="book-actions">
                    <form method="POST" action="{{ url_for('add_to_cart', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Add to Cart</button>
                    </form>

                    <form method="POST" action="{{ url_for('add_to_wishlist', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Wishlist</button>
                    </form>
                </div>
                {% endif %}

            </li>
            {% endfor %}
            <a href="{{ url_for('books') }}"><img class="viewall" src="{{ url_for('static', filename='images/viewall.png') }}" /></a>
        </ul>
        <h2>Dystopian</h2>
        <ul class="homepage-book-grid">
            {% for book in books[:6] if book.Genre == 'Dystopian' %}
            <li class="book-card" data-genre="{{ book.Genre }}" data-author="{{ book.Author }}" data-price="{{ book.Price }}">
                <a href="{{ url_for('book_detail', isbn=book.ISBN) }}">
                    <img class="book-cover"
                         src="{{ url_for('static', filename='book_covers/' ~ book.ISBN ~ '.jpg') }}"
                         onerror="this.onerror=null; this.src='{{ url_for('static', filename='book_covers/default.jpg') }}';"
                         alt="Cover for {{ book.Title }}">
                    <h3>{{ book.Title }}</h3>
                    <p>by {{ book.Author }}</p>
                    <p>${{ book.Price }}</p>

                    {% if book.avg_rating %}
                    <div class="stars">
                        {% for i in range(1, 6) %}
                        {% if i <= book.avg_rating|round(0, 'floor') %}
                        ★
                        {% else %}
                        ☆
                        {% endif %}
                        {% endfor %}
                        ({{ book.avg_rating }})
                    </div>
                    {% else %}
                    <div class="stars">
                        No reviews yet
                    </div>
                    {% endif %}
                </a>

                <!-- Employee Actions -->
                {% if current_user.role != 'customer' %}
                <div class="book-actions">
                    <!-- Edit stays a link because it’s GET -->
                    <a href="{{ url_for('edit_book', isbn=book.ISBN) }}">Edit</a>
                    <br>
                    <!-- Delete uses POST form -->
                    <form method="post" action="{{ url_for('delete_book', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Delete</button>
                    </form>
                </div>

                <!-- Customer Actions -->
                {% else %}
                <!-- Customer Actions -->
                <div class="book-actions">
                    <form method="POST" action="{{ url_for('add_to_cart', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Add to Cart</button>
                    </form>

                    <form method="POST" action="{{ url_for('add_to_wishlist', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Wishlist</button>
                    </form>
                </div>
                {% endif %}

            </li>
            {% endfor %}
            <a href="{{ url_for('books') }}"><img class="viewall" src="{{ url_for('static', filename='images/viewall.png') }}" /></a>
        </ul>
        <h2>Young Adult</h2>
        <ul class="homepage-book-grid">
            {% for book in books if book.Genre == 'Young Adult' %}
            <li class="book-card" data-genre="{{ book.Genre }}" data-author="{{ book.Author }}" data-price="{{ book.Price }}">
                <a href="{{ url_for('book_detail', isbn=book.ISBN) }}">
                    <img class="book-cover"
                         src="{{ url_for('static', filename='book_covers/' ~ book.ISBN ~ '.jpg') }}"
                         onerror="this.onerror=null; this.src='{{ url_for('static', filename='book_covers/default.jpg') }}';"
                         alt="Cover for {{ book.Title }}">
                    <h3>{{ book.Title }}</h3>
                    <p>by {{ book.Author }}</p>
                    <p>${{ book.Price }}</p>

                    {% if book.avg_rating %}
                    <div class="stars">
                        {% for i in range(1, 6) %}
                        {% if i <= book.avg_rating|round(0, 'floor') %}
                        ★
                        {% else %}
                        ☆
                        {% endif %}
                        {% endfor %}
                        ({{ book.avg_rating }})
                    </div>
                    {% else %}
                    <div class="stars">
                        No reviews yet
                    </div>
                    {% endif %}
                </a>

                <!-- Employee Actions -->
                {% if current_user.role != 'customer' %}
                <div class="book-actions">
                    <!-- Edit stays a link because it’s GET -->
                    <a href="{{ url_for('edit_book', isbn=book.ISBN) }}">Edit</a>
                    <br>
                    <!-- Delete uses POST form -->
                    <form method="post" action="{{ url_for('delete_book', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Delete</button>
                    </form>
                </div>

                <!-- Customer Actions -->
                {% else %}
                <!-- Customer Actions -->
                <div class="book-actions">
                    <form method="POST" action="{{ url_for('add_to_cart', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Add to Cart</button>
                    </form>

                    <form method="POST" action="{{ url_for('add_to_wishlist', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Wishlist</button>
                    </form>
                </div>
                {% endif %}

            </li>
            {% endfor %}
            <a href="{{ url_for('books') }}"><img class="viewall" src="{{ url_for('static', filename='images/viewall.png') }}" /></a>
        </ul>
        <h2>Classic</h2>
        <ul class="homepage-book-grid">
            {% for book in books if book.Genre == 'Classic' %}
            <li class="book-card" data-genre="{{ book.Genre }}" data-author="{{ book.Author }}" data-price="{{ book.Price }}">
                <a href="{{ url_for('book_detail', isbn=book.ISBN) }}">
                    <img class="book-cover"
                         src="{{ url_for('static', filename='book_covers/' ~ book.ISBN ~ '.jpg') }}"
                         onerror="this.onerror=null; this.src='{{ url_for('static', filename='book_covers/default.jpg') }}';"
                         alt="Cover for {{ book.Title }}">
                    <h3>{{ book.Title }}</h3>
                    <p>by {{ book.Author }}</p>
                    <p>${{ book.Price }}</p>

                    {% if book.avg_rating %}
                    <div class="stars">
                        {% for i in range(1, 6) %}
                        {% if i <= book.avg_rating|round(0, 'floor') %}
                        ★
                        {% else %}
                        ☆
                        {% endif %}
                        {% endfor %}
                        ({{ book.avg_rating }})
                    </div>
                    {% else %}
                    <div class="stars">
                        No reviews yet
                    </div>
                    {% endif %}
                </a>

                <!-- Employee Actions -->
                {% if current_user.role != 'customer' %}
                <div class="book-actions">
                    <!-- Edit stays a link because it’s GET -->
                    <a href="{{ url_for('edit_book', isbn=book.ISBN) }}">Edit</a>
                    <br>
                    <!-- Delete uses POST form -->
                    <form method="post" action="{{ url_for('delete_book', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Delete</button>
                    </form>
                </div>

                <!-- Customer Actions -->
                {% else %}
                <!-- Customer Actions -->
                <div class="book-actions">
                    <form method="POST" action="{{ url_for('add_to_cart', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Add to Cart</button>
                    </form>

                    <form method="POST" action="{{ url_for('add_to_wishlist', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Wishlist</button>
                    </form>
                </div>
                {% endif %}

            </li>
            {% endfor %}
            <a href="{{ url_for('books') }}"><img class="viewall" src="{{ url_for('static', filename='images/viewall.png') }}" /></a>
        </ul>
    </div>

    <script>
        function filterBooks() {
            const genre = document.getElementById('genre-filter').value;
            const author = document.getElementById('author-filter').value;
            const price = document.getElementById('price-filter').value;
            const books = document.querySelectorAll('.book-card');

            books.forEach(book => {
                let show = true;

                if (genre !== 'all' && book.dataset.genre !== genre) show = false;
                if (author !== 'all' && book.dataset.author !== author) show = false;
                if (price !== 'all' && parseFloat(book.dataset.price) > parseFloat(price)) show = false;

                book.style.display = show ? 'block' : 'none';
            });
        }
    </script>

</body>
</html>
