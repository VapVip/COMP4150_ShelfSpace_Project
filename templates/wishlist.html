<!DOCTYPE html>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
<html>
<head>
    <title>My Wishlist – ShelfSpace</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Quick inline styles for stars */
        .stars {
            color: gold;
            font-size: 1rem;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

    <!-- NAVBAR -->
    <div class="navbar">
        <div class="nav-left">
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('books') }}">Books</a>
            <a href="{{ url_for('about') }}">About</a>
            <a href="{{ url_for('contact') }}">Contact</a>
        </div>
        <div class="nav-center">
            <img src="{{ url_for('static', filename='images/logo.png') }}" />
        </div>
        <div class="nav-right">
            {% if not current_user.is_authenticated %}
            <a href="{{ url_for('register') }}">Register</a>
            <a href="{{ url_for('login') }}">Log In</a>
            {% else %}
            <p>Hello, {{ current_user.username }}!</p>
            {% if current_user.role == 'customer' %}
            <a href="{{ url_for('view_cart') }}" class="cart-link">
                <img src="{{ url_for('static', filename='images/cart-icon.png') }}" alt="Cart" class="cart-icon">
                {% if cart_count and cart_count > 0 %}
                <span class="cart-badge">{{ cart_count }}</span>
                {% endif %}
            </a>
            <a href="{{ url_for('view_wishlist') }}" class="wishlist-link navbar_active">
                <img src="{{ url_for('static', filename='images/heart-icon.png') }}" alt="Wishlist" class="wishlist-icon">
            </a>
            {% endif %}
            <a href="{{ url_for('account_details') }}">Account</a>
            <a href="{{ url_for('logout') }}">Log Out</a>
            {% endif %}
        </div>
    </div>

    <!-- PAGE CONTENT -->
    <div class="page-container">
        <h1>My Wishlist</h1>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% if books %}
        <ul class="book-grid">
            {% for book in books %}
            <li class="book-card">
                <a href="{{ url_for('book_detail', isbn=book.ISBN) }}">
                    <img class="book-cover"
                         src="{{ url_for('static', filename='book_covers/' ~ book.ISBN ~ '.jpg') }}"
                         onerror="this.onerror=null; this.src='{{ url_for('static', filename='book_covers/default.jpg') }}';"
                         alt="Cover for {{ book.Title }}">
                    <h3>{{ book.Title }}</h3>
                    <p>by {{ book.Author }}</p>
                    <p>${{ book.Price }}</p>

                    {% if book.avg_rating %}
                    <div class="stars">
                        {% for i in range(1, 6) %}
                        {% if i <= book.avg_rating|round(0, 'floor') %}
                        ★
                        {% else %}
                        ☆
                        {% endif %}
                        {% endfor %}
                        ({{ book.avg_rating }})
                    </div>
                    {% else %}
                    <div class="stars">
                        ☆☆☆☆☆ (0.0)
                    </div>
                    {% endif %}
                </a>

                <!-- Customer Actions -->
                <div class="book-actions-vertical">
                    <form method="POST" action="{{ url_for('add_to_cart', isbn=book.ISBN) }}" style="display:inline;">
                        <button type="submit">Add to Cart</button>
                    </form>
                    <form method="POST" action="{{ url_for('remove_from_wishlist', isbn=book.ISBN) }}">
                        <button type="submit">Remove</button>
                    </form>
                </div>

            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>Your wishlist is empty.</p>
        {% endif %}
    </div>

</body>
</html>

